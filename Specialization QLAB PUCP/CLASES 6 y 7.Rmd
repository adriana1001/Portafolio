---
title: "Clases 6 y 7"
---


```{r}
library(tidyverse)
library(readxl)
dataf<-read_xlsx("resultados_sv_2021.xlsx")
```
Ver columnas
```{r}
names(dataf)
```

Ver qué tipo de variables son
```{r}
glimpse(dataf)
```
Volver varias variables como numéricas
```{r}
#elegir las columnas 6 y 7 y aplicarles as.numeric
dataf[,6:7]<-lapply(dataf[,6:7], as.numeric)
```
Etiquetado de variables
```{r}
install.packages("Hmisc")
```

```{r}
library(Hmisc)
label(dataf$castillo)<- "Votación por Castillo"
label(dataf$keiko)<- "Votación por Keiko"
```
Uso del case_when()
```{r}
dataf<-dataf |>
  select(3,4,6,7) |>
  mutate(nivel_respaldo_castillo = case_when(castillo<30 ~ "Bajo", castillo<60 ~ "Medio", TRUE ~  "Alto"))

table(dataf$nivel_respaldo_castillo)
```
Le damos niveles
```{r}
dataf$nivel_respaldo_castillo<- factor(dataf$nivel_respaldo_castillo, levels = c("Bajo","Medio","Alto"), ordered=T)

#le damos un label
label(dataf$nivel_respaldo_castillo) = "Nivel de respaldo a Pedro Castillo"
```

Función GTSUMMARY
```{r}
install.packages("gtsummary")
```
Se presenta la información de las variables como una table resuen
```{r}
library(gtsummary)
dataf |> 
  select(castillo, keiko, nivel_respaldo_castillo) |> 
  tbl_summary()
```

Agregarle estadísticos
```{r}
dataf |> 
  select(castillo, keiko, nivel_respaldo_castillo) |> 
  tbl_summary(statistic = list(all_continuous() ~ "{mean} ({sd})"))
```
Ahora creamos una variable dummy dicotómica para ver si ganó castillo
```{r}
dataf<-dataf  |>   # Data
      mutate(castillo_gano=  
        case_when(castillo>keiko~1,  
                  TRUE~0))
label(dataf$castillo_gano)="Ganó Pedro Castillo"
```
Ahora usamos tbl summary
```{r}
dataf |> 
  select(castillo, keiko, nivel_respaldo_castillo, castillo_gano) |> 
  tbl_summary(statistic = list(all_continuous() ~ "{mean} ({sd})"))
```
Agreguemosle min y max
```{r}
dataf |> 
  select(castillo, keiko, nivel_respaldo_castillo, castillo_gano) |> 
  tbl_summary(
    type = keiko ~ "continuous2",
    statistic = list(all_continuous() ~ "{mean} ({sd})",
                    all_continuous2() ~ c("{mean} ({sd})", "{min}, {max}")))
```
Personalizamos la tabla
```{r}
dataf |> 
  select(castillo, keiko, nivel_respaldo_castillo, castillo_gano) |> 
  tbl_summary(
    type = keiko ~ "continuous2",
    statistic = list(all_continuous() ~ "{mean} ({sd})",
                    all_continuous2() ~ c("{mean} ({sd})", "{min}, {max}"))) |> 
  modify_header(label = "**Variable de interés**") |> 
  modify_caption("**Tabla resumen con `gtsummary`**") 
```

Mutating joins
Para agregar filas o columnas a la base de datos
```{r}
# Crear la primera tabla de ejemplo
tabla1 <- data.frame(
  ID = 1:10,
  Nombre = c('Ana', 'Carlos', 'Elena', 'Luis', 'María', 'Pedro', 'Rosa', 'José', 'Clara', 'Marta'),
  Edad = c(23, 34, 45, 28, 39, 41, 30, 38, 33, 29))

# Crear la segunda tabla de ejemplo
tabla2 <- data.frame(
  ID = c(1, 3, 5, 7, 9, 11, 12, 13, 14, 15),
  Puntaje = c(88, 92, 75, 85, 90, 67, 72, 83, 94, 77))
```
Visualizamos
```{r}
tabla1
tabla2
```
La variable key es la columna o conjunto de columnas que existen en ambas tablas y que se usan para encontrar las filas correspondientes en cada tabla. Es esencialmente el criterio de emparejamiento. Por ejemplo, si tienes una tabla con datos demográficos de personas (tabla1) y otra con sus puntajes en un examen (tabla2), la clave podría ser una columna como ID que identifique de manera única a cada persona en ambas tablas.

left_join() toma todas las filas de tabla1 (la tabla de la izquierda) y añade las columnas de tabla2 donde haya coincidencias en la columna ID. Si no hay coincidencia en tabla2, las nuevas columnas tendrán valores NA
```{r}
left_join_result <- left_join(tabla1, tabla2, by = "ID")
left_join_result
```
right_join() toma todas las filas de tabla2 (la tabla de la derecha) y añade las columnas de tabla1 donde haya coincidencias en la columna ID. Si no hay coincidencia en tabla1, las nuevas columnas tendrán valores NA.
```{r}
right_join_result <- right_join(tabla1, tabla2, by = "ID")
right_join_result
```

inner_join() devuelve solo las filas donde haya coincidencias en la columna ID en ambas tablas. Las filas sin coincidencia son eliminadas del resultado.
```{r}
inner_join_result <- inner_join(tabla1, tabla2, by = "ID")
inner_join_result
```
full_join() devuelve todas las filas de ambas tablas. Si hay coincidencia en la columna ID, las filas se combinan; si no hay coincidencia, se incluyen las filas con valores NA en las columnas donde no hubo coincidencia.
```{r}
full_join_result <- full_join(tabla1, tabla2, by = "ID")
full_join_result
```

